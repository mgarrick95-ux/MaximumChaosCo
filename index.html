<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="manifest" href="manifest.webmanifest"/>
<link rel="icon" href="icon-192.png"/>
<meta name="theme-color" content="#7c3aed"/>
<title>MaximumChaosCo ‚Ä¢ Brain Fog Buster</title>
<style>
  :root{
    --bg:#0b0f1d; --ink:#f8fafc; --muted:#cbd5e1;
    --card:#121836; --edge:#ffffff24; --accent:#7c3aed; --accent2:#22d3ee;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:var(--bg) url('bg.png') center/cover fixed no-repeat;
  }
  .wrap{max-width:950px; margin:0 auto; padding:16px}
  header{display:flex; align-items:center; gap:10px; margin-bottom:10px}
  .brand{font-weight:800; font-size:1.25rem; letter-spacing:.5px}
  .tag{margin-left:auto; color:var(--muted); font-size:.9rem}
  .tabs{display:flex; gap:8px; flex-wrap:wrap; margin:12px 0}
  .tab{padding:8px 12px; border-radius:12px; border:1px solid var(--edge); background:#ffffff12; cursor:pointer; user-select:none}
  .tab.active{background:linear-gradient(180deg,#8b5cf6,#7c3aed); border-color:#7c3aed}
  .pane{background:var(--card); border:1px solid var(--edge); border-radius:16px; padding:14px; box-shadow:0 10px 40px #0007; margin-top:10px}
  label{display:block; color:var(--muted); font-size:.9rem; margin-bottom:6px}
  textarea,input{width:100%; background:#0f1430; border:1px solid var(--edge); color:var(--ink); padding:10px; border-radius:12px}
  textarea{min-height:140px}
  .controls{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px}
  .btn{border:1px solid var(--edge); background:linear-gradient(180deg,#ffffff18,#00000018); color:var(--ink); padding:8px 12px; border-radius:12px; cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#8b5cf6,#7c3aed); border-color:#7c3aed}
  .list{display:grid; gap:8px; margin-top:10px}
  .card{background:#0f1430; border:1px dashed var(--edge); border-radius:12px; padding:10px}
  .pill{font-size:.75rem; color:#22d3ee; background:#22d3ee22; border:1px solid #22d3ee55; border-radius:999px; padding:2px 8px}
  .row{display:flex; gap:8px; align-items:center; justify-content:space-between}
  .muted{color:var(--muted)}
  .foot{margin:16px 0; text-align:center; color:var(--muted); font-size:.85rem}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">MaximumChaosCo ‚Ä¢ Brain Fog Buster</div>
    <div class="tag">Watercolor ‚Ä¢ Sparkly ‚Ä¢ Rough edges</div>
  </header>

  <div class="tabs">
    <div class="tab active" data-tab="dump">üß† Brain Dump</div>
    <div class="tab" data-tab="wins">‚ö° Tiny Wins</div>
    <div class="tab" data-tab="settings">‚öôÔ∏è Settings</div>
  </div>

  <!-- Brain Dump -->
  <section class="pane" id="dumpPane">
    <label>Write it out. No judgement. No grammar police.</label>
    <textarea id="dumpText" placeholder="Type here‚Ä¶"></textarea>
    <div class="controls">
      <select id="dumpType">
        <option>vent</option>
        <option>thought</option>
        <option>to‚Äëdo</option>
        <option>idea</option>
      </select>
      <button id="dumpAdd" class="btn primary">Add</button>
      <button id="dumpExport" class="btn">Backup JSON</button>
      <input id="dumpImport" type="file" accept=".json" style="display:none">
      <button id="dumpImportBtn" class="btn">Restore</button>
      <span class="muted" style="margin-left:auto">Items: <span id="dumpCount">0</span></span>
    </div>
    <div id="dumpList" class="list"></div>
  </section>

  <!-- Tiny Wins -->
  <section class="pane" id="winsPane" style="display:none">
    <label>Check them off for dopamine confetti.</label>
    <div class="controls">
      <input id="winText" placeholder="e.g., Took meds, sent email"/>
      <button id="winAdd" class="btn primary">Add Win</button>
      <button id="winReset" class="btn">Reset</button>
    </div>
    <div id="winList" class="list"></div>
  </section>

  <!-- Settings -->
  <section class="pane" id="settingsPane" style="display:none">
    <div class="list">
      <div class="card">
        <div class="row"><div>Install as app</div><button class="btn" onclick="installPWA()">Install</button></div>
      </div>
      <div class="card">
        <div class="row"><div>Hard refresh (fix stuck cache)</div><a class="btn" href="./?v=2">Reload v2</a></div>
      </div>
    </div>
  </section>

  <div class="foot">Offline ‚Ä¢ Private ‚Ä¢ Yours. Add to home screen for full vibes ‚ú®</div>
</div>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', ()=> navigator.serviceWorker.register('./service-worker.js').catch(()=>{}));
  }

  // Tab logic
  const tabs = document.querySelectorAll('.tab');
  const panes = { dump: '#dumpPane', wins:'#winsPane', settings:'#settingsPane' };
  tabs.forEach(t=> t.addEventListener('click', ()=>{
    tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active');
    Object.values(panes).forEach(sel=> document.querySelector(sel).style.display='none');
    const id = panes[t.dataset.tab]; document.querySelector(id).style.display='block';
  }));

  // Local storage keys
  const K_DUMP='bfb_dump_v2'; const K_WINS='bfb_wins_v2';

  // Brain Dump
  const dumpText = document.getElementById('dumpText');
  const dumpType = document.getElementById('dumpType');
  const dumpList = document.getElementById('dumpList');
  const dumpCount = document.getElementById('dumpCount');
  function readDump(){ try{return JSON.parse(localStorage.getItem(K_DUMP)||'[]')}catch{return[]} }
  function writeDump(arr){ localStorage.setItem(K_DUMP, JSON.stringify(arr)); dumpCount.textContent=arr.length; }
  function renderDump(){
    const arr = readDump();
    dumpCount.textContent=arr.length;
    dumpList.innerHTML = arr.map((it,i)=>`<div class="card">
      <div class="row"><span class="pill">${it.type}</span>
      <span class="muted">${new Date(it.ts).toLocaleString()}</span></div>
      <div style="margin-top:6px">${escapeHtml(it.text)}</div>
      <div class="controls" style="margin-top:6px">
        <button class="btn small" onclick="editDump(${i})">Edit</button>
        <button class="btn small" onclick="delDump(${i})">Delete</button>
      </div>
    </div>`).join('') || '<div class="muted">Nothing yet ‚Äî type above and Add.</div>';
  }
  function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
  function addDump(){
    const t = dumpText.value.trim(); if(!t) return;
    const arr = readDump(); arr.unshift({text:t, type:dumpType.value, ts:Date.now()});
    writeDump(arr); dumpText.value=''; renderDump();
  }
  function delDump(i){ const arr = readDump(); arr.splice(i,1); writeDump(arr); renderDump(); }
  window.editDump = (i)=>{
    const arr = readDump(); const v = prompt('Edit entry:', arr[i].text||''); if(v===null) return;
    arr[i].text = v; writeDump(arr); renderDump();
  }
  document.getElementById('dumpAdd').addEventListener('click', addDump);
  document.getElementById('dumpExport').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(readDump(), null, 2)],{type:'application/json'});
  });
  document.getElementById('dumpImportBtn').addEventListener('click', ()=> document.getElementById('dumpImport').click());
  document.getElementById('dumpImport').addEventListener('change', (e)=>{
    const f=e.target.files&&e.target.files[0]; if(!f) return;
    const reader=new FileReader(); reader.onload=()=>{ try{ writeDump(JSON.parse(reader.result)); renderDump(); alert('Restored ‚úì'); }catch(e){alert('Bad file')} };
    reader.readAsText(f); e.target.value='';
  });

  // Tiny Wins
  const winText = document.getElementById('winText');
  const winList = document.getElementById('winList');
  function readWins(){ try{return JSON.parse(localStorage.getItem(K_WINS)||'[]')}catch{return[]} }
  function writeWins(arr){ localStorage.setItem(K_WINS, JSON.stringify(arr)); }
  function renderWins(){
    const arr = readWins();
    winList.innerHTML = arr.map((w,i)=>`<div class="card row">
      <label class="row" style="gap:8px;align-items:center">
        <input type="checkbox" ${w.done?'checked':''} onchange="toggleWin(${i}, this.checked)"/>
        ${escapeHtml(w.text)}
      </label>
      <button class="btn small" onclick="delWin(${i})">Delete</button>
    </div>`).join('') || '<div class="muted">Add a quick win above.</div>';
  }
  function addWin(){ const t=winText.value.trim(); if(!t) return; const arr=readWins(); arr.unshift({text:t,done:false}); writeWins(arr); winText.value=''; renderWins(); }
  window.toggleWin = (i,val)=>{ const arr=readWins(); arr[i].done=val; writeWins(arr); };
  window.delWin = (i)=>{ const arr=readWins(); arr.splice(i,1); writeWins(arr); renderWins(); };
  document.getElementById('winAdd').addEventListener('click', addWin);
  document.getElementById('winReset').addEventListener('click', ()=>{ writeWins([]); renderWins(); });

  // PWA install
  let deferredPrompt=null;
  window.addEventListener('beforeinstallprompt',e=>{ e.preventDefault(); deferredPrompt=e; });
  window.installPWA = async ()=>{ if(!deferredPrompt) return alert('Open in browser to install'); deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; };

  // init
  renderDump(); renderWins();
</script>
</body>
</html>
